<div>
    <app-loading *ngIf="loading(); else tasksList" [message]="'Fetching Tasks for employee'"></app-loading>
    <ng-template #tasksList>
        <div class="employee-tasks-bg min-h-[90vh] flex flex-col items-center justify-center px-2 py-8 font-[Segoe UI]">

            <!-- Loading & Error States -->
            <!-- <div *ngIf="tasks().loading" class="text-gray-500 mb-4">Loading...</div>
            <div *ngIf="tasks().error" class="text-red-600 mb-4">Error: {{ tasks().error }}</div> -->

            <!-- Task List -->
            <ng-container *ngIf="filteredTasks().length > 0; else noTasks">
                <!-- All completed message -->
                <div *ngIf="allTasksCompleted(); else taskMsg"
                    class="bg-gradient-to-r from-green-100 to-green-200 border border-green-300 text-green-900 p-5 rounded-xl mb-6 shadow animate-fade-in flex items-center gap-3">
                    <i class="fa-solid fa-circle-check text-green-500 text-2xl animate-bounce"></i>
                    <span class="font-semibold">You have completed all tasks for this employee under your role.</span>
                </div>
                <ng-template #taskMsg>
                    <div class="p-4 rounded-xl mb-4 bg-white/90 shadow animate-fade-in">
                        <h2
                            class="text-2xl font-extrabold mb-2 text-center flex items-center justify-center gap-2 text-gray-900">
                            <i class="fa-solid fa-list-check text-blue-500 animate-bounce"></i>
                            Tasks assigned to you for <span class="text-amber-900">{{ employee()?.firstName }} {{
                                employee()?.lastName }}</span> onboarding process.
                        </h2>
                    </div>
                </ng-template>
                <!-- Task Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div *ngFor="let task of filteredTasks(); let i = index"
                        class="task-card bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:scale-[1.03] hover:shadow-2xl transition-all duration-300 relative overflow-hidden animate-fade-in">
                        <div class="absolute -top-4 -right-4 opacity-10 text-[6rem] pointer-events-none select-none">
                            <i class="fa-solid fa-clipboard-list"></i>
                        </div>
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-bold text-blue-900 flex items-center gap-2">
                                <i class="fa-solid fa-tasks text-blue-400"></i>
                                {{ task.title }}
                            </h3>
                            <span class="text-xs font-bold px-3 py-1 rounded-full shadow-sm border border-gray-200"
                                [ngClass]="{
                                        'bg-green-100 text-green-800': task.status === 'COMPLETED',
                                        'bg-yellow-100 text-yellow-800': task.status === 'IN_PROGRESS',
                                        'bg-gray-100 text-gray-600': task.status === 'PENDING'
                                    }">
                                <i class="fa-solid fa-circle mr-1" [ngClass]="{
                                            'text-green-400': task.status === 'COMPLETED',
                                            'text-yellow-400': task.status === 'IN_PROGRESS',
                                            'text-gray-400': task.status === 'PENDING'
                                        }"></i>
                                {{ task.status }}
                            </span>
                        </div>
                        <p class="text-gray-700 mb-4">{{ task.description }}</p>
                        <div class="flex justify-end">
                            <button *ngIf="task.status === 'IN_PROGRESS'" (click)="selectTask(task.taskId)"
                                class="cursor-pointer bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white px-5 py-2 text-sm rounded-lg font-bold shadow transition-all duration-300 flex items-center gap-2 animate-pop-in">
                                <i class="fa-solid fa-check"></i> Complete Task
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- No Tasks -->
            <ng-template #noTasks>
                <div
                    class="bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 p-6 rounded-xl mt-6 shadow animate-fade-in text-center">
                    <i class="fa-solid fa-inbox text-3xl mb-2 text-gray-400 animate-bounce"></i>
                    <h5 class="font-bold text-lg">No tasks available for your role.</h5>
                    <p class="mt-2 text-base">
                        Onboarding Stage: <strong>{{ employee()?.onboardingStage }}</strong><br />
                        Onboarding Status: <strong>{{ employee()?.onboardingStatus }}</strong>
                    </p>
                </div>
            </ng-template>
            <div *ngIf="selectedTask() as task"
                class="fixed inset-0 z-50 flex items-center justify-center bg-[#0a1833cc] bg-opacity-70 backdrop-blur-sm">
                <div
                    class="bg-gradient-to-r from-white to-blue-50 rounded-lg shadow-lg p-8 w-full max-w-lg relative animate-pop-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold flex items-center gap-2"><i
                                class="fa-solid fa-file-arrow-up"></i>
                            Complete the Task</h3>
                        <button class="text-red-500 hover:text-red-600 cursor-pointer" (click)="closeModal()">
                            <i class="fa-solid fa-xmark text-2xl"></i>
                        </button>
                    </div>
                    <hr>
                    <app-dynamic-form [formSchema]="selectedTask()?.formlyConfigJson!"
                        (formSubmit)="handleFormSubmit($event,selectedTask())"></app-dynamic-form>
                </div>
            </div>
        </div>
    </ng-template>
</div>