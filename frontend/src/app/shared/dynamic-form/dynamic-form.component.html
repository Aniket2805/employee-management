<form [formGroup]="form" (ngSubmit)="onSubmit()">
    <h2 class="font-bold text-xl py-4 text-gray-800 text-center">{{ formSchema.formTitle }}</h2>

    <div *ngFor="let control of formSchema.formControls" [ngClass]="control.class" class="mb-4">
        <div class="flex flex-col">
            <label>
                {{ control.label }}
                <span *ngIf="isRequired(control)" class="text-red-600">*</span>
            </label>
            <ng-container [ngSwitch]="control.type">
                <!-- File -->
                <input *ngSwitchCase="'file'" type="file" (change)="onFileChange($event, control.name)"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none text-gray-600" />

                <!-- Text Input -->
                <input *ngSwitchCase="'input'" type="text" [formControlName]="control.name"
                    [placeholder]="control.placeholder"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none text-gray-600" />


                <!-- MultiCheckbox -->
                <div *ngSwitchCase="'multicheckbox'" class="mt-1 flex flex-col gap-2">
                    <ng-container *ngFor="let opt of control.options; let i = index">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" [formControl]="multicheckboxControls(control.name)[i]"
                                [id]="control.name + '_' + i" />
                            <label [for]="control.name + '_' + i" class="text-gray-700 cursor-pointer">{{ opt.label
                                }}</label>
                        </div>
                    </ng-container>
                </div>

                <!-- Select Dropdown -->
                <select *ngSwitchCase="'select'" [formControlName]="control.name"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none text-gray-600 bg-white">
                    <option value="" disabled selected>Select {{ control.label }}</option>
                    <option *ngFor="let opt of control.options" [value]="opt.value">{{ opt.label }}</option>
                </select>

                <!-- Date -->
                <input *ngSwitchCase="'date'" type="date" [formControlName]="control.name"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none text-gray-600" />

                <!-- Textarea -->
                <textarea *ngSwitchCase="'textarea'" [formControlName]="control.name"
                    [placeholder]="control.placeholder" rows="4"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none text-gray-600"></textarea>

                <!-- Checkbox -->
                <input *ngSwitchCase="'checkbox'" type="checkbox" [formControlName]="control.name" class="mt-1" />

                <!-- Readonly Link: use click handler so we can include auth header when fetching -->
                <button *ngSwitchCase="'readonly-link'" type="button"
                    (click)="openReadOnly(control.templateOptions?.url)"
                    class="text-blue-600 underline mt-2 bg-transparent border-0 p-0 cursor-pointer">
                    {{ control.templateOptions?.text || 'View Document' }}
                </button>
            </ng-container>
            <!-- Required error message -->
            <div *ngIf="form.get(control.name)?.touched && form.get(control.name)?.invalid && form.get(control.name)?.errors?.['required']"
                class="text-sm text-red-600 mt-1">
                {{ getValidatorMessage(control, 'required') }}
            </div>

            <!-- Pattern error message -->
            <div *ngIf="form.get(control.name)?.touched && form.get(control.name)?.invalid && form.get(control.name)?.errors?.['pattern']"
                class="text-sm text-red-600 mt-1">
                {{ getValidatorMessage(control, 'pattern') }}
            </div>
            <!-- File extension error message -->
            <div *ngIf="form.get(control.name)?.touched && form.get(control.name)?.invalid && form.get(control.name)?.errors?.['fileExtension']"
                class="text-sm text-red-600 mt-1">
                {{ getValidatorMessage(control, 'fileExtension') }}
            </div>
            <!--  Min Length -->
            <div *ngIf="form.get(control.name)?.touched && form.get(control.name)?.invalid && form.get(control.name)?.errors?.['minlength']"
                class="text-sm text-red-600 mt-1">
                {{ getValidatorMessage(control, 'minLength') }}
            </div>
            <!-- Max Length -->
            <div *ngIf="form.get(control.name)?.touched && form.get(control.name)?.invalid && form.get(control.name)?.errors?.['maxlength']"
                class="text-sm text-red-600 mt-1">
                {{ getValidatorMessage(control, 'maxLength') }}
            </div>


        </div>

    </div>
    <button type="submit"
        class="bg-green-500 hover:bg-green-600 cursor-pointer transition-all duration-300 text-white px-4 py-2 rounded-md mt-4"
        [ngClass]="{'opacity-50 cursor-not-allowed': form.invalid}"><i
            class="fa-solid fa-paper-plane mr-1"></i>Submit</button>
</form>